<div class="mx-auto md:w-2/3 w-full flex">
  <div class="mx-auto">

    <%= render @company %>

    <%= link_to "Edit this company", edit_company_path(@company), class: "mt-2 rounded-lg py-3 px-5 bg-gray-100 inline-block font-medium" %>
    <%= link_to "Back to companies", companies_path, class: "ml-2 rounded-lg py-3 px-5 bg-gray-100 inline-block font-medium" %>
    <%= link_to "Delete", @company, data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: "ml-2 rounded-lg py-3 px-5 bg-gray-100 inline-block font-medium" %>

    <div id="company_links">
      <%= render "companylinks/form", company:@company, companylink: @new_company_link%>
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Link</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @company.companylinks.select{ |pl| pl.name.present? }.each do |companylink| %>
            <tr>
              <td><%= companylink.name %></td>
              <td><%= companylink.link %></td>
              <td>
               <%= button_to "Delete link", destroy_content_company_companylink_path(@company, companylink, name: companylink.name), method: :delete, data: { confirm: "Are you sure?" } %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div id="people_company">
      <%= render "personcompanies/formcompany", company: @company, personcompany: @new_person_company %>
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Is Working</th>
            <th>Is My Company contact</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @company.personcompanies.select { |pc| pc.person.present? }.each do |pc| %>
            <tr>
              <td><%= link_to pc.person.name, person_path(pc.person) %></td>
              <td><%= pc.is_working ? "Yes" : "No" %></td>
              <td><%= pc.is_my_contact ? "Yes" : "No" %></td>
              <td>
                <%= link_to "Delete", destroy_by_company_personcompanies_path(@company, pc.person), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" } %>
                <%= link_to "Update Is Working", update_is_working_by_company_personcompanies_path(@company, pc.person), data: { turbo_method: :patch } %>
                <%= link_to "Update Main Contact", update_is_my_contact_by_company_personcompanies_path(@company, pc.person), data: { turbo_method: :patch } %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div id="notes">
      <%= render "companynotes/form", company: @company, companynote: @new_company_note %>
      <table>
        <thead>
          <tr>
            <th>Note</th>
            <th>Author</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @company.companynotes.select { |note| note.id.present? }.each do |note| %>
            <tr>
              <td><%= note.note %></td>
              <td><%= note.user.email %></td>
              <td>
                <%= link_to "Edit", edit_company_companynote_path(@company, note) %>
                <%= link_to "Delete", company_companynote_path(@company, note), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" } %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- New Section: Notes for Each Person Currently Working -->
    <div id="people_notes">
      <% @company.personcompanies.each do |pc| %>
        <% if pc.person %>
          <h3>Notes for <%= pc.person.name %>:</h3>
          <table>
            <thead>
              <tr>
                <th>Note</th>
                <th>Author</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% pc.person.personnotes.each do |note| %>
                <tr>
                  <td><%= note.note %></td>
                  <td><%= note.user.email %></td>
                  <td>
                    <%= link_to "Edit", edit_person_personnote_path(pc.person, note) %>
                    <%= link_to "Delete", person_personnote_path(pc.person, note), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" } %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
