<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Pi Ww" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon.png">
    <%= stylesheet_link_tag "tailwind", "inter-font", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <%= favicon_link_tag asset_path('favicon.png') %>
  </head>

  <body>
    <button id="sidebar-toggle" class="p-4 bg-white text-gray-700 fixed top-0 left-0 z-50">â˜°</button>
    <%= render 'layouts/sidebar' %>
    <div id="main" class="relative transition-all duration-300 ease-in-out z-30 ml-64">
      <div id="overlay" class="fixed top-0 left-56 right-0 bottom-0 bg-gray-900 bg-opacity-60 z-40 pointer-events-none opacity-0 transition-opacity duration-300"></div>
      <nav>
        <% if notice.present? || alert.present? %>
        <div class="absolute inset-x-0 top-0 h-16 w-full text-center mb-4 mt-4">
          <% if notice %>
            <p class="text-green-600"><%= notice %></p>
          <% end %>
          <% if alert %>
            <p class="text-red-600"><%= alert %></p>
          <% end %>
        </div>
        <% end %>
      </nav>
      <%= yield %>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function() {
        var sidebarWidth = $('#sidebar').width();

        function updateMainMargin() {
          if ($('#sidebar').hasClass('hidden')) {
            $('#main').css('margin-left', '0');
          } else {
            $('#main').css('margin-left', sidebarWidth + 'px');
          }
        }

        updateMainMargin();

        $('#sidebar-toggle').on('click', function() {
          $('#sidebar').removeClass('hidden -translate-x-full');
          $('#main').css('margin-left', sidebarWidth + 'px');
          $('#overlay').removeClass('pointer-events-none').css('opacity', '1');
          $('#sidebar-toggle').hide();
        });

        $('#sidebar-close').on('click', function() {
          $('#sidebar').addClass('hidden -translate-x-full');
          $('#main').css('margin-left', '0');
          $('#overlay').addClass('pointer-events-none').css('opacity', '0');
          $('#sidebar-toggle').show();
        });
        
        $('#overlay').on('click', function() {
          if ($('#sidebar').hasClass('hidden') === false) {
            $('#sidebar').addClass('hidden -translate-x-full');
            $('#main').css('margin-left', '0');
            $('#overlay').addClass('pointer-events-none').css('opacity', '0');
            $('#sidebar-toggle').show();
          }
        });
        $(window).resize(function() {
          sidebarWidth = $('#sidebar').width();
          updateMainMargin();
        });
      });
    </script>
  </body>
</html>
